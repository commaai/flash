<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="src/app/icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Update your comma device to the latest software"
    />
    <title>flash.comma.ai</title>
    <link href="https://cdn.jsdelivr.net/npm/@fontsource-variable/inter@5.1.0/index.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fontsource-variable/jetbrains-mono@5.1.1/index.min.css" rel="stylesheet">
    <link href="src/tailwindcss.css" rel="stylesheet">
  </head>
  <body>
    <div class="flex flex-col lg:flex-row flex-wrap">
      <main class="p-12 md:p-16 lg:p-20 xl:p-24 w-screen max-w-none lg:max-w-prose lg:w-auto h-auto lg:h-screen lg:overflow-y-auto prose dark:prose-invert prose-green bg-white dark:bg-gray-900">
        <section>
          <img src="src/assets/comma.svg" alt="comma" width="128" height="128" class="dark:invert" />
          <h1>flash.comma.ai</h1>
          <p>This tool allows you to flash AGNOS onto your comma device.</p>
          <p>
            AGNOS is the Ubuntu-based operating system for your 
            <a href="https://comma.ai/shop/comma-3x" target="_blank">comma 3/3X</a>.
          </p>
        </section>
        <hr />

        <section>
          <h2>Requirements</h2>
          <ul>
            <li>
              A web browser which supports WebUSB (such as Google Chrome, Microsoft Edge, Opera), running on Windows, macOS, Linux, or Android.
            </li>
            <li>
              A USB-C cable to power your device outside the car.
            </li>
            <li>
              Another USB-C cable to connect the device to your computer.
            </li>
          </ul>
          <h3>USB Driver</h3>
          <p>
            You need additional driver software for Windows before you connect
            your device.
          </p>
          <ol>
            <li>
              Download and install <a href="https://zadig.akeo.ie/">Zadig</a>.
            </li>
            <li>
              Under <code>Device</code> in the menu bar, select <code>Create New Device</code>.
              <img
                src="src/assets/zadig_create_new_device.png"
                alt="Zadig Create New Device"
                width="575"
                height="254"
              />
            </li>
            <li>
              Fill in three fields. The first field is just a description and
              you can fill in anything.  The next two fields are very important.
              Fill them in with <code>05C6</code> and <code>9008</code> respectively.
              Press &quot;Install Driver&quot; and give it a few minutes to install.
              <img
                src="src/assets/zadig_form.png"
                alt="Zadig Form"
                width="575"
                height="254"
              />
            </li>
          </ol>
          <p>
            No additional software is required for macOS or Linux.
          </p>
        </section>
        <hr />

        <section>
          <h2>QDL Mode</h2>
          <p>Follow these steps to put your device into QDL mode:</p>
          <ol>
            <li>Power off the device and wait for the LEDs to switch off.</li>
            <li>Connect the device to your computer using the USB-C port <strong>(port 2)</strong>.</li>
            <li>Connect power to the OBD-C port <strong>(port 1)</strong>.</li>
            <li>The device then should be visible as an option when choosing the device to flash</li>
          </ol>
          <img
            src="src/assets/fastboot-ports.svg"
            alt="image showing comma three and two ports. the upper port is labeled 1. the lower port is labeled 2."
            width="450"
            height="300"
          />
        </section>
        <hr />

        <section>
          <h2>Flashing</h2>
          <p>
            After your device is in QDL mode, you can click the button to start flashing. A prompt may appear to
            select a device; choose the device starts with <code>QUSB_BULK</code>.
          </p>
          <p>
            The process can take 30+ minutes depending on your internet connection and system performance. Do not
            unplug the device until all steps are complete.
          </p>
        </section>
        <hr />

        <section>
          <h2>Troubleshooting</h2>
          <h3>Too slow</h3>
          <p>
            It is recommended that you use a USB 3.0 cable when flashing since it will speed up the flashing time by a lot.
          </p>
          <h3>Cannot enter QDL</h3>
          <p>
            Try using a different USB cable or USB port. Sometimes USB 2.0 ports work better than USB 3.0 (blue) ports.
            If you&apos;re using a USB hub, try connecting the device directly to your computer, or alternatively use a
            USB hub between your computer and the device.
          </p>
          <h3>My device&apos;s screen is blank</h3>
          <p>
            The device screen will be blank in QDL mode, but you can verify that it is in QDL if the device shows up
            when you press the Flash icon.
          </p>
          <h3>After flashing, device says unable to mount data partition</h3>
          <p>
            This is expected after the filesystem is erased. Press confirm to finish resetting your device.
          </p>
          <h3>General Tips</h3>
          <ul>
            <li>Try another computer or OS</li>
            <li>Try different USB ports on your computer</li>
            <li>Try different USB-C cables, including the OBD-C cable that came with the device</li>
          </ul>
          <h3>Other questions</h3>
          <p>
            If you need help, join our <a href="https://discord.comma.ai" target="_blank">Discord server</a> and go to
            the <strong>#hw-three-3x</strong> channel.
          </p>
        </section>

        <div class="hidden lg:block">
          <hr />
          flash.comma.ai version: <code>dev</code>
        </div>
      </main>

      <div id="root" class="lg:flex-1 h-[700px] lg:h-screen bg-gray-100 dark:bg-gray-800">
        <p class="text-black dark:text-white">Loading...</p>
      </div>

      <div class="w-screen max-w-none p-12 md:p-16 prose dark:prose-invert bg-white dark:bg-gray-900 lg:hidden">
        flash.comma.ai version: <code>dev</code>
      </div>
    </div>

    <script type="importmap">
      {
        "imports": {
          "react": "https://cdn.jsdelivr.net/npm/react@18.3.1/+esm",
          "react-dom": "https://cdn.jsdelivr.net/npm/react-dom@18.3.1/+esm",
          "comlink": "https://cdn.jsdelivr.net/npm/comlink@4.4.2/+esm",
          "crc-32": "https://cdn.jsdelivr.net/npm/crc-32@1.2.2/+esm",
          "jssha": "https://cdn.jsdelivr.net/npm/jssha@3.3.1/+esm",
          "xz-decompress": "https://cdn.jsdelivr.net/npm/xz-decompress@0.2.1/+esm"
        }
      }
    </script>
    <link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/react@18.3.1/+esm" />
    <link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/scheduler@0.23.2/+esm" />
    <link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/comlink@4.4.2/+esm" />
    <link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/crc-32@1.2.2/+esm" />
    <link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/jssha@3.3.1/+esm" />
    <link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/xz-decompress@0.2.1/+esm" />
    <link rel="modulepreload" href="src/app/Flash.js" />
    <link rel="modulepreload" href="src/config.js" />
    <link rel="modulepreload" href="src/QDL/utils.js" />
    <link rel="modulepreload" href="src/QDL/qdl.js" />
    <link rel="modulepreload" href="src/QDL/gpt.js" />
    <link rel="modulepreload" href="src/QDL/usblib.js" />
    <link rel="modulepreload" href="src/QDL/sahara.js" />
    <link rel="modulepreload" href="src/QDL/firehose.js" />
    <link rel="modulepreload" href="src/QDL/saharaDefs.js" />
    <link rel="modulepreload" href="src/QDL/xmlParser.js" />
    <link rel="modulepreload" href="src/QDL/sparse.js" />
    <link rel="modulepreload" href="src/utils/flash.js" />
    <link rel="modulepreload" href="src/utils/blob.js" />
    <link rel="modulepreload" href="src/utils/image.js" />
    <link rel="modulepreload" href="src/utils/manifest.js" />
    <link rel="modulepreload" href="src/utils/progress.js" />
    <link rel="modulepreload" href="src/workers/image.worker.js" />
    <script type="module" src="src/main.js"></script>
    <script
      defer
      data-domain="flash.comma.ai"
      src="https://plausible.io/js/script.outbound-links.js"
    ></script>
  </body>
</html>
